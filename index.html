<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Mycila Guice by mycila</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Mycila Guice</h1>
          <h2>Mycila Guice Extensions</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/mycila/guice/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/mycila/guice/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/mycila/guice" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p><strong>Table of Contents</strong></p>

<ul>
<li>
<a href="#mycila-guice-extensions">Mycila Guice Extensions</a>

<ul>
<li><a href="#build-status">Build Status</a></li>
<li><a href="#maven-repository">Maven Repository</a></li>
<li>
<a href="#extensions">Extensions</a>

<ul>
<li><a href="#1-customizes-injection-annotations">1. Customizes injection annotations</a></li>
<li><a href="#2-closeable-injector">2. Closeable Injector</a></li>
<li><a href="#3-jsr-250">3. JSR-250</a></li>
<li><a href="#4-legacy-and-factory-binder">4. Legacy and Factory Binder</a></li>
<li><a href="#5-service-and-module-discovery">5. Service and Module discovery</a></li>
<li><a href="#6-web-extensions">6. Web Extensions</a></li>
<li><a href="#7-groovy-extensions">7. Groovy Extensions</a></li>
<li><a href="#8-servlet-extension">8. Servlet Extension</a></li>
</ul>
</li>
</ul>
</li>
</ul><h1>
<a name="mycila-guice-extensions" class="anchor" href="#mycila-guice-extensions"><span class="octicon octicon-link"></span></a>Mycila Guice Extensions</h1>

<p>This project contains a set of Google Guice Extensions useful in every-days development with <a href="https://code.google.com/p/google-guice/">Google Guice</a>.</p>

<p><strong>Issues:</strong> <a href="https://github.com/mycila/guice/issues">https://github.com/mycila/guice/issues</a></p>

<p><img width="100px" src="http://www.sonatype.com/system/images/W1siZiIsIjIwMTMvMDQvMTIvMTEvNDAvMzcvMTgzL05leHVzX0ZlYXR1cmVfTWF0cml4X29zZ2lfbG9nby5wbmciXV0/Nexus-Feature-Matrix-osgi-logo.png" title="OSGI Compliant"><a href="https://travis-ci.org/mycila/guice"><img src="https://travis-ci.org/mycila/guice.png?branch=master" alt="Build Status"></a>
<a href="https://bitdeli.com/free" title="Bitdeli Badge"><img src="https://d2weczhvl823v0.cloudfront.net/mycila/guice/trend.png" alt="Bitdeli Badge"></a>
<a href="http://githalytics.com/mycila/guice"><img src="https://cruel-carlota.pagodabox.com/1875760f595bd5c7cb70197871c0d854" alt="githalytics.com alpha" title="githalytics.com"></a></p>

<h2>
<a name="maven-repository" class="anchor" href="#maven-repository"><span class="octicon octicon-link"></span></a>Maven Repository</h2>

<ul>
<li>
<strong>Releases</strong> </li>
</ul><p>Available in Maven Central Repository: <a href="http://repo1.maven.org/maven2/com/mycila/guice/extensions/">http://repo1.maven.org/maven2/com/mycila/guice/extensions/</a></p>

<ul>
<li><strong>Snapshots</strong></li>
</ul><p>Available in OSS Repository:  <a href="https://oss.sonatype.org/content/repositories/snapshots/com/mycila/guice/extensions/">https://oss.sonatype.org/content/repositories/snapshots/com/mycila/guice/extensions/</a></p>

<h2>
<a name="extensions" class="anchor" href="#extensions"><span class="octicon octicon-link"></span></a>Extensions</h2>

<h3>
<a name="1-customizes-injection-annotations" class="anchor" href="#1-customizes-injection-annotations"><span class="octicon octicon-link"></span></a>1. Customizes injection annotations</h3>

<p>This extensions enables you to define custom injection annotations and use them. This extensions is used by the <a href="#3-jsr-250">JSR-250 extension</a>.  </p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-injection&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Usage</strong></p>

<p>In example, suppose you have your own annotation called <code>@Autowire</code> to inject dependencies. You could automatically support <code>@Resource</code>, <code>@Inject</code> and <code>@Autowire</code> at the same time. Supposing you'd like to use this annotation to inject your dependencies:</p>

<pre><code>@Target({METHOD, CONSTRUCTOR, FIELD})
@Retention(RUNTIME)
public @interface Autowire {
    String value() default "";
}
</code></pre>

<p>You have to define a <code>KeyProvider</code> which help creating the Guice key used to recover a dependency from the annotation information plus the injected member.</p>

<pre><code>public class AutowireKeyProvider extends KeyProviderSkeleton&lt;Autowire&gt; {
    @Override
    public Key&lt;?&gt; getKey(TypeLiteral&lt;?&gt; injectedType, Field injectedMember, Autowire resourceAnnotation) {
        String name = resourceAnnotation.value();
        return name.length() == 0 ?
                super.getKey(injectedType, injectedMember, resourceAnnotation) :
                Key.get(injectedType.getFieldType(injectedMember), Names.named(name));
    }
}
</code></pre>

<p>Once the key provider is defined, just add this code in your Guice module:</p>

<pre><code>MBinder.wrap(binder()).bindAnnotationInjector(Autowire.class, AutowireKeyProvider.class);
</code></pre>

<h3>
<a name="2-closeable-injector" class="anchor" href="#2-closeable-injector"><span class="octicon octicon-link"></span></a>2. Closeable Injector</h3>

<p>This extension allows your classes to listen when an Injector is closed, to be able to clean some resources for example.</p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-closeable&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Note</strong></p>

<p>This extension is automatically loaded if you are using the <a href="#5-service-and-module-discovery">Service and Module discovery extension</a>.</p>

<p><strong>Usage</strong></p>

<p>Bind in your module the classes you want to be aware of Injector closing. Those classes must implement the <code>InjectorCloseListener</code> interface. </p>

<pre><code>public interface InjectorCloseListener {
    void onInjectorClosing();
}
</code></pre>

<p>Create your Injector has usual and add the <code>CloseableModule</code>.</p>

<pre><code>Injector injector = Guice.createInjector(Stage.PRODUCTION, new CloseableModule(), new MyModule());
</code></pre>

<p>Or like this:</p>

<pre><code>CloseableInjector injector = Guice.createInjector(Stage.PRODUCTION, new CloseableModule(), new MyModule()).getInstance(CloseableInjector.class);
</code></pre>

<p>The <code>CloseableInjector</code> is juste the plain standard Injector enhanced with a <code>close()</code> method. You can use it instead of the default <code>Injector</code>.</p>

<p>When your application ends, just close the Injector like this if you are using the <code>CloseableInjector</code>: </p>

<pre><code>injector.close()
</code></pre>

<p>Or if you are using Guice's <code>Injector</code> class:</p>

<pre><code>injector.getInstance(CloseableInjector.class).close();
</code></pre>

<h3>
<a name="3-jsr-250" class="anchor" href="#3-jsr-250"><span class="octicon octicon-link"></span></a>3. JSR-250</h3>

<p>This extension adds JSR-250 (object life-cycle) support to Guice.</p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-closeable&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Notes</strong></p>

<p>This extension depends on the <a href="#2-closeable-injector">Closeable Injector extension</a> and both can be automatically automatically loaded if you are using the <a href="#5-service-and-module-discovery">Service and Module discovery extension</a>.</p>

<p><code>@PreDestroy</code> only works for singletons.</p>

<p><strong>Usage</strong></p>

<p>Create your <code>Injector</code> with those two modules also: <code>Jsr250Module</code> and <code>CloseableModule</code>.</p>

<pre><code>Injector injector = Guice.createInjector(Stage.PRODUCTION, new CloseableModule(), new Jsr250Module(), new MyModule());
</code></pre>

<p>if you are using the <a href="#5-service-and-module-discovery">Service and Module discovery extension</a>, you just need to create the Injector like this as usual.</p>

<pre><code>Injector injector = Guice.createInjector(Stage.PRODUCTION, new MyModule());
</code></pre>

<p>And that's all you need to have you <code>@PostConstruct</code>, <code>@PreDestroy</code> and <code>@Resource</code> annotations working!</p>

<p>Do not forget when you have finished working with the <code>Injector</code> to close it so that <code>@PreDestroy</code> methods get called. </p>

<pre><code>injector.getInstance(CloseableInjector.class).close();
</code></pre>

<p><strong>Example of JSR-250 class</strong></p>

<pre><code>@Singleton
public class Bank {

    List&lt;Account&gt; accounts = new ArrayList&lt;Account&gt;();

    @Resource
    Provider&lt;Account&gt; provider;

    @PostConstruct
    void openBank() {
        // create two accounts initially
        accounts.add(provider.get());
        accounts.add(provider.get());
    }

    @PreDestroy
    void close() {
        accounts.clear();
    }
}
</code></pre>

<h3>
<a name="4-legacy-and-factory-binder" class="anchor" href="#4-legacy-and-factory-binder"><span class="octicon octicon-link"></span></a>4. Legacy and Factory Binder</h3>

<p>This extension allows the binding easily of legacy code or objects build through a factory method. </p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-legacy&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Usage</strong></p>

<p>Suppose that you have the following classes having an old-way designed with factory classes:</p>

<pre><code>public interface Repository {
    // [...]
}
</code></pre>

<p>And its factory:</p>

<pre><code>public class ServiceFactory {

    public void setOption(String option) {
        // [...]
    }

    public Repository newRepository(Connection con) { 
        // [...] (code using option to return a Repository) 
    }

}
</code></pre>

<p>By using the <code>LegacyProvider</code> of this extension you can bind the <code>Repository</code> like this in your Guice module:</p>

<pre><code>bind(Repository.class).toProvider(LegacyProvider.of(Repository.class)
    .withFactory(ServiceFactory.class, "create", Connection.class)
    .inject("setOption", String.class)
);
</code></pre>

<p>This enables Guice to load and inject the <code>ServiceFactory</code> and get all the parameters also from the Guice bindings.</p>

<h3>
<a name="5-service-and-module-discovery" class="anchor" href="#5-service-and-module-discovery"><span class="octicon octicon-link"></span></a>5. Service and Module discovery</h3>

<p>This extension allows the discovery of Guice module automatically in the classpath by using the JDK Service Loader feature. You can also bind custom interfaces and automatically discover and inject into the implementations defined on the classpath.</p>

<p>Since automatic discovery does not allow you to control bindings, this extension comes with an <code>@OverrideModule</code> annotation to be able to flag modules which overrides existing bindings.</p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-service&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Usage</strong></p>

<p><strong><em>Loading Guice module from the classpath</em></strong></p>

<p>Put a file in your classpath called <code>com.google.inject.Module</code> in the <code>META-INF/services</code> folder containing the complete class names of your modules. In example:</p>

<pre><code># In `META-INF/services/com.google.inject.Module`
com.mycila.guice.ext.service.MyModule
com.mycila.guice.ext.service.MyOverrideModule
</code></pre>

<p>Then load your <code>Injector</code> with the <code>ServiceModule</code>:</p>

<pre><code>Injector injector = Guice.createInjector(new ServiceModule());
</code></pre>

<p>This will also add the two other module in your <code>Injector</code>.</p>

<p><strong><em>Loading custom implementations from the classpath</em></strong></p>

<p>You can also bind an interface to one or several implementations discovered on the classpath by using the providers <code>SingleServiceProvider</code> or <code>MultiServiceProvider</code>.  </p>

<pre><code>bind(MyService.class).toProvider(new SingleServiceProvider&lt;&gt;(Service.class));
</code></pre>

<p>Or to bind all discovered implementations to an array: </p>

<pre><code>bind(MyService[].class).toProvider(new MultiServiceProvider&lt;&gt;(Service.class));
</code></pre>

<p>Just put on your classpath the file <code>META-INF/services/my.package.MyService</code> and the list of implementations in it.</p>

<h3>
<a name="6-web-extensions" class="anchor" href="#6-web-extensions"><span class="octicon octicon-link"></span></a>6. Web Extensions</h3>

<p>This extension facilitate the setup of a Guice environment within a web application.</p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-web&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Usage</strong></p>

<p>Just declare the <code>MycilaGuiceListener</code> as a listener in your <code>web.xml</code> file. The listener automatically creates a Guice injector by using the <a href="#5-service-and-module-discovery">Service and Module discovery extension</a>.</p>

<pre><code>&lt;listener&gt;
    &lt;listener-class&gt;com.mycila.guice.ext.web.MycilaGuiceListener&lt;/listener-class&gt;
&lt;/listener&gt;
</code></pre>

<h3>
<a name="7-groovy-extensions" class="anchor" href="#7-groovy-extensions"><span class="octicon octicon-link"></span></a>7. Groovy Extensions</h3>

<p>This extension scans for classes having methods annotated by <code>@Expand</code> and add those methods to target Groovy classes.</p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-groovy&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p><strong>Note</strong></p>

<p>This extension is automatically discovered when using the <a href="#5-service-and-module-discovery">Service and Module discovery extension</a>.</p>

<p><strong>Usage</strong></p>

<p>Just add the module <code>ExpandModule</code> in your Injector. Supposing you have a repository class and a Book class:</p>

<pre><code>class Book {
    // [...]
}

class BookRepository {

    @Expand(Book)
    Book findById(String id) { [...] }

    @Expand(Book)
    Book save(Book b) { [...] }

} 
</code></pre>

<p>Than you can now in your code execute:</p>

<pre><code>Book b = Book.findById('123')
// [...]
b.save()
</code></pre>

<h3>
<a name="8-servlet-extension" class="anchor" href="#8-servlet-extension"><span class="octicon octicon-link"></span></a>8. Servlet Extension</h3>

<p>Same code as the official Google Guice Servlet Extension, but do not depend on internal Guice stuff but on external Guava dependency instead.  </p>

<p><strong>Maven dependency</strong></p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.mycila.guice.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;mycila-guice-servlet&lt;/artifactId&gt;
    &lt;version&gt;X.Y.ga&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
        </section>

        <footer>
          Mycila Guice is maintained by <a href="https://github.com/mycila">mycila</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>